(function(){var t=UM.dom.domUtils,n="video";UM.registerWidget(n,{tpl:'<link rel="stylesheet" type="text/css" href="<%=video_url%>video.css" />'+'<div class="edui-video-wrapper"><div id="eduiVideoTab"><div id="eduiVideoTabHeads" class="edui-video-tabhead">'+'<span tabSrc="video" class="edui-video-focus"><%=lang_tab_insertV%><\/span>'+'<\/div><div id="eduiVideoTabBodys" class="edui-video-tabbody"><div id="eduiVideoPanel" class="edui-video-panel">'+'<table><tr><td><label for="eduiVideoUrl" class="edui-video-url"><%=lang_video_url%><\/label><\/td><td><input id="eduiVideoUrl" type="text"><\/td><\/tr><\/table>'+'<div id="eduiVideoPreview"><\/div><div id="eduiVideoInfo"><fieldset>'+"<legend><%=lang_video_size%><\/legend>"+"<table>"+'<tr><td><label for="eduiVideoWidth"><%=lang_videoW%><\/label><\/td><td><input class="edui-video-txt" id="eduiVideoWidth" type="text"/><\/td><\/tr>'+'<tr><td><label for="eduiVideoHeight"><%=lang_videoH%><\/label><\/td><td><input class="edui-video-txt" id="eduiVideoHeight" type="text"/><\/td><\/tr>'+"<\/table><\/fieldset><fieldset>"+"<legend><%=lang_alignment%><\/legend>"+'<div id="eduiVideoFloat"><\/div><\/fieldset><\/div><\/div><\/div><\/div><\/div>',initContent:function(t,i){var r=this,u=t.getLang(n),f=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/video/";r.lang=u;r.editor=t;r.$widget=i;r.root().html($.parseTmpl(r.tpl,$.extend({video_url:f},u.static)));r.initController(u)},initEvent:function(){var n=this,t=$("#eduiVideoUrl",n.$widget)[0];"oninput"in t?t.oninput=function(){n.createPreviewVideo(this.value)}:t.onpropertychange=function(){n.createPreviewVideo(this.value)}},initController:function(){var n=this,i=n.editor.selection.getRange().getClosedNode(),r,u,f;n.createAlignButton(["eduiVideoFloat"]);i&&i.className=="edui-faked-video"&&($("#eduiVideoUrl",n.$widget)[0].value=r=i.getAttribute("_url"),$("#eduiVideoWidth",n.$widget)[0].value=i.width,$("#eduiVideoHeight",n.$widget)[0].value=i.height,u=t.getComputedStyle(i,"float"),f=t.getComputedStyle(i.parentNode,"text-align"),n.updateAlignButton(f==="center"?"center":u));n.createPreviewVideo(r)},createPreviewVideo:function(n){if(n){var t=this,i=t.lang,r=t.convert_url(n);if(!t.endWith(r,[".swf",".flv",".wmv"])){$("#eduiVideoPreview",t.$widget).html(i.urlError);return}$("#eduiVideoPreview",t.$widget)[0].innerHTML='<embed type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+n+'" width="420" height="280" wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" ><\/embed>'}},insertSingle:function(){var n=this,t=$("#eduiVideoWidth",n.$widget)[0],i=$("#eduiVideoHeight",n.$widget)[0],r=$("#eduiVideoUrl",n.$widget)[0].value,u=this.findFocus("eduiVideoFloat","name");if(!r||!n.checkNum([t,i]))return!1;this.editor.execCommand("insertvideo",{url:n.convert_url(r),width:t.value,height:i.value,align:u})},convert_url:function(n){if(!n)return"";var t=n.match(/youtu.be\/(\w+)$/)||n.match(/youtube\.com\/watch\?v=(\w+)/)||n.match(/youtube.com\/v\/(\w+)/),i=n.match(/youku\.com\/v_show\/id_(\w+)/),r=/player\.youku\.com/ig.test(n);return r?n.replace(/\?f=.*/,""):t?"https://www.youtube.com/v/"+t[1]+"?version=3&feature=player_embedded":i?"http://player.youku.com/player.php/sid/"+i[1]+"/v.swf":n.replace(/http:\/\/www\.tudou\.com\/programs\/view\/([\w\-]+)\/?/i,"http://www.tudou.com/v/$1").replace(/http:\/\/www\.youtube\.com\/watch\?v=([\w\-]+)/i,"http://www.youtube.com/v/$1").replace(/http:\/\/v\.youku\.com\/v_show\/id_([\w\-=]+)\.html/i,"http://player.youku.com/player.php/sid/$1").replace(/http:\/\/www\.56\.com\/u\d+\/v_([\w\-]+)\.html/i,"http://player.56.com/v_$1.swf").replace(/http:\/\/www.56.com\/w\d+\/play_album\-aid\-\d+_vid\-([^.]+)\.html/i,"http://player.56.com/v_$1.swf").replace(/http:\/\/v\.ku6\.com\/.+\/([^.]+)\.html/i,"http://player.ku6.com/refer/$1/v.swf").replace(/\?f=.*/,"")},checkNum:function(n){for(var i,r=this,u=0,t;t=n[u++];)if(i=t.value,!r.isNumber(i)&&i)return alert(r.lang.numError),t.value="",t.focus(),!1;return!0},isNumber:function(n){return/(0|^[1-9]\d*$)/.test(n)},updateAlignButton:function(n){for(var i=$("#eduiVideoFloat",this.$widget)[0].children,r=0,t;t=i[r++];)t.getAttribute("name")==n?t.className!="edui-video-focus"&&(t.className="edui-video-focus"):t.className=="edui-video-focus"&&(t.className="")},createAlignButton:function(n){for(var e,f,i,t,r=this.lang,o=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/video/",s=0,u;u=n[s++];){e=$("#"+u,this.$widget)[0];f={none:r["default"],left:r.floatLeft,right:r.floatRight};for(i in f)t=document.createElement("div"),t.setAttribute("name",i),i=="none"&&(t.className="edui-video-focus"),t.style.cssText="background:url("+o+"images/"+i+"_focus.jpg);",t.setAttribute("title",f[i]),e.appendChild(t);this.switchSelect(u)}},switchSelect:function(n){for(var t=$("#"+n,this.$widget)[0].children,r=0,i;i=t[r++];)$(i).on("click",function(){for(var i=0,n;n=t[i++];)n.className="",n.removeAttribute&&n.removeAttribute("class");this.className="edui-video-focus"})},findFocus:function(n,t){for(var u=$("#"+n,this.$widget)[0].children,r,f=0,i;i=u[f++];)if(i.className=="edui-video-focus"){r=i.getAttribute(t);break}return r},endWith:function(n,t){for(var r,i=0,u=t.length;i<u;i++){if(r=t[i],n.length-r.length<0)return!1;if(n.substring(n.length-r.length)==r)return!0}return!1},width:610,height:498,buttons:{ok:{exec:function(t,i){$("#eduiVideoPreview",i).html("");t.getWidgetData(n).insertSingle()}},cancel:{exec:function(){$("#eduiVideoPreview").html("")}}}})})();
//# sourceMappingURL=video.min.js.map
